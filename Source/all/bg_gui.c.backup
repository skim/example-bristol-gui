#include "bg_config.h"
#include "bg_starter.h"
#include "gtkc_all.h"
#include <gtk/gtk.h>

#define WINDOW_ROOT	"window_root"
#define WINDOW_HELP	"window_help"
#define VIEW_HELP	"view_help"

void bg_gui_combo_configuration_prepare(const char *name) {
	GtkListStore *store = gtk_list_store_new(1, G_TYPE_STRING);
	GtkComboBox *combo = gtkc_get_combo_box(name);
	gtk_combo_box_set_model(combo, GTK_TREE_MODEL(store));
	gtk_combo_box_set_active(combo, 0);
	GtkCellRenderer *renderer = gtk_cell_renderer_text_new();
	gtk_cell_layout_pack_start(GTK_CELL_LAYOUT(combo), renderer, TRUE);
	gtk_cell_layout_set_attributes(GTK_CELL_LAYOUT(combo), renderer, "text", 0, NULL);
	g_object_unref(G_OBJECT(store));
}

void bg_gui_combo_soundengine_prepare(const char *name) {
	GtkListStore *store = gtk_list_store_new(2, G_TYPE_STRING, G_TYPE_UINT);
	GtkTreeIter iter;
	gtk_list_store_append(store, &iter);
	gtk_list_store_set(store, &iter, 0, "JACK", 1, BG_JACK, -1);
	gtk_list_store_append(store, &iter);
	gtk_list_store_set(store, &iter, 0, "ALSA", 1, BG_ALSA, -1);
	gtk_list_store_append(store, &iter);
	gtk_list_store_set(store, &iter, 0, "Pulse Audio", 1, BG_PULSE, -1);
	gtk_list_store_append(store, &iter);
	gtk_list_store_set(store, &iter, 0, "OSS", 1, BG_OSS, -1);
	GtkComboBox *combo = gtkc_get_combo_box(name);
	gtk_combo_box_set_model(combo, GTK_TREE_MODEL(store));
	gtk_combo_box_set_active(combo, 0);
	GtkCellRenderer *renderer = gtk_cell_renderer_text_new();
	gtk_cell_layout_pack_start(GTK_CELL_LAYOUT(combo), renderer, TRUE);
	gtk_cell_layout_set_attributes(GTK_CELL_LAYOUT(combo), renderer, "text", 0, NULL);
	g_object_unref(G_OBJECT(store));
}

void bg_gui_update(bg_gui *gui, bg_configuration *config) {
	g_assert(gui != NULL);
	g_assert(config != NULL);
	char *name = g_strconcat("combo_soundengine_", gui->name, NULL);
	gtkc_combo_box_set_active(name, config->soundengine);
	name = g_strconcat("entry_identifier_", gui->name, NULL);
	gtkc_entry_set_value(name, config->identifier);
	name = g_strconcat("adjust_samplerate_", gui->name, NULL);
	gtkc_adjustment_set_value(name, config->samplerate);
	name = g_strconcat("adjust_periodsize_", gui->name, NULL);
	gtkc_adjustment_set_value(name, config->periodsize);
	name = g_strconcat("adjust_midichannel_", gui->name, NULL);
	gtkc_adjustment_set_value(name, config->midichannel);
	name = g_strconcat("combo_configuration_", gui->name, NULL);
	GtkTreeIter *iter = gtkc_combo_box_append(name);
	GtkListStore *store = gtkc_combo_box_get_model(name);
	gtk_list_store_set(store, iter, 0, config->name, -1);
	gtkc_combo_box_set_active(name, 0);
	name = g_strconcat("label_configuration_", gui->name, NULL);
	gtkc_label_set_text(name, config->name);
	g_free(name);
}

bg_gui* bg_gui_new(const char *name) {
	bg_gui *gui = g_new(bg_gui, 1);
	gui->name = g_strdup(name);
	char *_name = g_strconcat("combo_configuration_", gui->name, NULL);
	bg_gui_combo_configuration_prepare(_name);
	_name = g_strconcat("combo_soundengine_", gui->name, NULL);
	bg_gui_combo_soundengine_prepare(_name);
	g_free(_name);
	return gui;
}
